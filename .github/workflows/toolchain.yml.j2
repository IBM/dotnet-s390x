{#-
Workflow template. Regenerate the workflow using the ./update script.
-#}

# Do not edit this file. It is generated from toolchain.yml.j2.

{%- set paths %}
    paths:
    - 'docker/**'
    - '.github/workflows/toolchain.yml'
{%- endset %}

on:
  push:
    branches:
      - main
    {{- paths }}
  pull_request:
    {{- paths }}

jobs:
  toolchain:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        arch: [ppc64le, s390x, x64]
    steps:
    - uses: actions/checkout@v4
    {%- set image = 'ghcr.io/ibm/dotnet-${{ matrix.arch }}-toolchain:latest' %}
    - name: Build
      run: ARCH={% raw %}${{ matrix.arch }}{% endraw %} docker/build -t {{ image }}
    - name: Login
      run: echo {% raw %}${{ secrets.GHCR_PASSWORD }}{% endraw %} |
           docker login ghcr.io --username={% raw %}${{ secrets.GHCR_USERNAME }}{% endraw %} --password-stdin
      if: {% raw %}${{ github.event_name == 'push' }}{% endraw %}
    - name: Push
      run: docker push {{ image }}
      if: {% raw %}${{ github.event_name == 'push' }}{% endraw %}
